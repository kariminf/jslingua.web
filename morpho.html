<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>JsLingua-Morphology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="./assets/favicon.png">
  <link rel="stylesheet" href="assets/jslingua.css">

  <script src="assets/w3.js"></script>
  <script type="text/javascript" src="assets/call.js"></script>
  <script type="text/javascript">
  addScript("jslingua.min.js");
  addScript("morpho.min.js");
  addScript("ara.morpho.min.js");
  addScript("eng.morpho.min.js");
  addScript("fra.morpho.min.js");
  addScript("jpn.morpho.min.js");
  </script>

  <script type="text/javascript">
  var morpho = {};
  var $ = function(id){return document.getElementById(id)};
  var _ = function(e){return e.options[e.selectedIndex]};

  var conjParams = {
    rows: {},
    cols: {}
  };

  function loading(){
    var e = $("l");

    var langIDs = JsLingua.serviceLanguages("Morpho");
    var i;
    for (i = 0; i < langIDs.length; i++){
      var option = document.createElement("option");
      option.text = langIDs[i];
      e.add(option);
    }

    update();

  }

  function update(){
    var lang = _($("l")).text, dir= JsLingua.getDir(lang);
    morpho = new (JsLingua.getService("Morpho", lang))();
    $("verb").dir =
    $("conj").dir =
    $("stemI").dir =
    $("stemO").dir =
    $("normI").dir =
    $("normO").dir = dir;

    var stemmers = morpho.availableStemmers();
    var m = $("stemM");
    var i = m.options.length;
    while (i--) m.remove(i);

    stemmers.forEach(function(element, index, array){
      var option = document.createElement("option");
      option.text = element;
      m.add(option);
    });

    var text = "";
    var repeat = 1;
    conjParams = JsLingua.Cls.Morpho.parseConjModel(morpho);

    var rr = conjParams.rows.labels.length;
    var text2 = "";
    while(rr--) text2 += "<th class=\"noCol\"></th>"

    conjParams.cols.labels.forEach(function(v, i, a){
      text += "<tr>" + text2;
      var rep = repeat;
      repeat *= v.length;
      while(rep--){
        v.forEach(function(v2, i2, a2){
          text += "<th colspan=\"" + conjParams.cols.spans[i] + "\">";
          text += v2;
          text += "</th>";
        });
      }

      text += "</tr>";
    });
    conjParams.colHtml = text;

    setMethod();
  }

  function setMethod(){
    var sn = _($("stemM")).value;
    if (sn) morpho.setCurrentStemmer(sn);
  }

  function htmlEntities(str) {
    var result = String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;');
    result = result.replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/ /gi, "&nbsp;");
    return result;
  }

  function conjugate() {
    var verb = $("verb").value;
    var result = "";

    var forms = morpho.getForms();
    var typeOpts = {vtype:morpho.getVerbType(verb)};

    for (k in forms) {
      result += "<div class=\"k-1 k-l-2 \"><h3>" + k + "</h3>";
      result += "<table class=\"k-tab\">" + conjParams.colHtml;
      var ropts = conjParams.rows.opts;
      var copts = conjParams.cols.opts;
      var rlabels = conjParams.rows.labels;
      var rspans = conjParams.rows.spans;
      var lIdx = 0;

      for(var rowi=0; rowi < ropts.length; rowi++){
        result += "<tr>";
        var rlabelIdx = rowi;
        for (var rowj=0; rowj < rlabels.length; rowj++){
          var idx = ~~(rlabelIdx / rspans[rowj]);
          rlabelIdx = rlabelIdx % rspans[rowj];
          if (rlabelIdx===0){
            result += "<th rowspan=\"" + rspans[rowj] + "\">";
            result += rlabels[rowj][idx];
            result += "</th>";
          }
        }

        for(coli = 0; coli < copts.length; coli++){
          result += "<td >";
          var fuseOpts = Object.assign({}, ropts[rowi], copts[coli], forms[k], typeOpts);
          result += morpho.conjugate(verb, fuseOpts);
          result += "</td>";
        }


        result += "</tr>";
      }

      result += "</table>";
      result += "</div>";
    }

    $("conj").innerHTML = result;
  }

  function stem(){
    $("stemO").innerHTML = morpho.stem($("stemI").value);
  }

  function norm(){
    $("normO").innerHTML = morpho.normalize($("normI").value);
  }

  </script>

</head>
<body>

  <div w3-include-html="menu.html"></div>

  <div class="content-wrapper">
    <h1>Morpho module</h1>
    <div class="content hflex">

      <div class="k-fs k-1">
        <h1><span>Description</span></h1>
        <div>
          This module affords morphological functions that can be executed on words.
          <ul>
            <li>Choose the language first</li>
            <li>Stemming: it is the function of deleting prefixes, suffixes and infixes.
              It leaves you with just a root which usually doesn't belong to the language syntax.
              Try:
              <ul>
                <li>Ara: استفاق, يستعملون, أتكلمونني, فراشات, فرشاة</li>
                <li>Eng: conditional, allowance</li>
                <li>Fra: continuait, continuellement, continueront, maintenaient, majorités</li>
                <li>Jpn: 用いられている, 伝わっていない, 高くなかった, 行かなければならない, 強調したい</li>
              </ul>
            </li>
            <li>Normalization: it is the function of transforming language variations to a single canonical form.
              For example, the dialects have other forms of writing a text.
              Try:
              <ul>
                <li>Ara: ذَهــَبَ ,ذهــــــــب ,دعــــى ,دعاة ,آسف ,دعى ,إنه</li>
                <li>Eng: ain't, innit, gonna, y'all, C'mon, cop, lil', gimme, ma, luv </li>
                <li>Fra: (NOT YET) </li>
                <li>Jpn: 雨ねええ, 雨ねぇぇぇ, すげえええ, そうかなぁぁぁぁ, 犬やない, 言ったばい, 飲まへん, 帰るさかい,
                  飲みんさんな, 行きますえ, 書いてちょう, 寒いべ, 寒いっしょ, 明日しょや
                </li>
              </ul>
            </li>
            <li>Conjugation: just put a verb in its dictionary form and push "conjugate".
              Try:
              <ul>
                <li>Ara: استعمل, لعب, قال, جمع, استوى</li>
                <li>Eng: undergo, stay, cry, let</li>
                <li>Fra: être, avoir, aller, chanter, manger, appeler, commencer, choisir (3ième groupe: NOT YET)</li>
                <li>Jpn: 勉強する, 行く, 飲む, 遊ぶ, 来る</li>
              </ul>
            </li>
          </ul>
        </div>
      </div> <!-- end Description -->

      <div class="k-fs k-1">
        <h1><span>Language</span></h1>
        <label>Choose the language:</label>
        <select id="l" class="k-select" onchange="update()">
        </select>
      </div>

      <div class="k-fs k-1">
        <h1><span>Stemming</span></h1>
        <label>Method</label>
        <select id="stemM" class="k-select" onchange="setMethod()">
        </select><br>
        <input type="text" id="stemI" class="k-input k-1"/><br>
        <button onclick="stem()" class="k-button">Stem</button><br>
        <div id="stemO" class="k-input k-1" ></div>
      </div>

      <div class="k-fs k-1">
        <h1><span>Normalization</span></h1>
        <input type="text" id="normI" class="k-input k-1"/><br>
        <button onclick="norm()" class="k-button">Stem</button><br>
        <div id="normO" class="k-input k-1" ></div>
      </div>

      <div class="k-fs k-1">
        <h1><span>Verb Conjugation</span></h1>
        <input type="text" id="verb" class="k-input k-1" /><br>
        <button onclick="conjugate()" class="k-button">Conjugate</button><br>
        <div id="conj" class="hflex" ></div>
      </div>

    </div>

    <div class="k-footer-clean"></div>

    <div w3-include-html="footer.html"></div>

  </div>

  <script>
  w3.includeHTML();
  loading();
  </script>

</body>
</html>
